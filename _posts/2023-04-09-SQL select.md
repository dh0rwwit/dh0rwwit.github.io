---
title: SQL 예제풀이 및 해석 _ HTML 변환전
author: dh0rwwit
date: 2023-04-09 00:00:00 +0600
categories: [other,HTML변환전텍스트]
tags: [SQL_ORACLE,정처기실기]
render_with_liquid: false
---

sql을 공부할 때는 그나마.... ISO/IEC 9075 기준을 만족해주는 oracle을 설치하고 실습해보는게 낫다.

;) 데이터베이스 > 스키마 > 테이블, 뷰 > 튜플, 속성 > 레코드


    실습을 위해 <사원>, <상여금> 테이블을 작성함.
    사용한 SQL은 ORACLE이다. 

    CREATE TABLE 사원(
        이름 VARCHAR(20),
        부서 VARCHAR(20),
        생일 DATE,
        주소 VARCHAR(20),
        기본급 INT,
        CONSTRAINT PK_이름 PRIMARY KEY(이름)
    );

    COL 이름 FORMAT A10;
    COL 부서 FORMAT A10;
    COL 생일 FORMAT A12;
    COL 주소 FORMAT A10;
    col 기본급 format 9999;
    set pagesize 100;
    ALTER SESSION SET NLS_DATE_FORMAT = 'DD/MM/YY'; -- 0000년 00월 00일 시분초는 ALTER SESSION SET NLS_DATE_FORMAT = 'DD/MM/YYYY HH:MI:SS';

    COMMIT;
    SAVEPOINT S1; -- ROLLBACK S1;

    DELETE FROM 사원;

    insert into 사원 (이름,부서,생일,주소,기본급) values('김현수','기획','04/05/61','관악구',120);
    insert into 사원 (이름,부서,생일,주소,기본급) values('이현재','인터넷','11/09/69','중랑구',80);
    insert into 사원 (이름,부서,생일,주소,기본급) values('최정상','편집','07/11/75','수성구',100);
    insert into 사원 (이름,부서,생일,주소,기본급) values('장소정','편집','22/12/73','연희동',90);
    insert into 사원 (이름,부서,생일,주소,기본급) values('홍길동','기획','01/09/69','강남구',110);
    insert into 사원 (이름,부서,생일,주소,기본급) values('서지영','인터넷','13/03/77','구로구',100);
    insert into 사원 (이름,부서,생일,주소,기본급) values('이대연','인터넷','25/06/70','관악구',110);
    insert into 사원 (이름,부서,생일,주소,기본급) values('박소연','인터넷','14/12/72','수성구',90);
    insert into 사원 (이름,부서,생일,주소,기본급) values('강국현','인터넷','05/09/73','관악구',100);
    insert into 사원 (이름,부서,생일,주소,기본급) values('서이현','기획','17/05/65','노원구',110);
    insert into 사원 (이름,부서,생일,주소,기본급) values('장선우','편집','16/05/71','관악구',90);
    insert into 사원 (이름,부서,생일,주소,기본급) values('황종근','기획','10/03/67','도봉구',110);
    insert into 사원 (이름,부서,생일,주소,기본급) values('임주연','편집','30/05/77','관악구',90);

    SELECT * FROM 사원;

    COMMIT;
    SAVEPOINT S2; -- ROLLBACK S1;

    CREATE TABLE 상여금(
        부서 VARCHAR(20),
        이름 VARCHAR(20),
        상여내역 DATE,
        상여금 INT
    );

    -- DELETE FROM 상여금;

    insert into 상여금 (부서,이름,상여내역,상여금) values('기획','김현수','연장근무', 50);
    insert into 상여금 (부서,이름,상여내역,상여금) values('인터넷','이현재','연장근무', 50);
    insert into 상여금 (부서,이름,상여내역,상여금) values('편집','최정상','야간근무', 60);
    insert into 상여금 (부서,이름,상여내역,상여금) values('편집','장소정','특별근무', 45);
    insert into 상여금 (부서,이름,상여내역,상여금) values('기획','홍길동','특별근무', 40);
    insert into 상여금 (부서,이름,상여내역,상여금) values('인터넷','서지영','특별근무', 50);
    insert into 상여금 (부서,이름,상여내역,상여금) values('인터넷','이대연','연장근무', 40);
    insert into 상여금 (부서,이름,상여내역,상여금) values('인터넷','박소연','특별근무', 40);
    insert into 상여금 (부서,이름,상여내역,상여금) values('편집','강국현','특별근무', 30);
    insert into 상여금 (부서,이름,상여내역,상여금) values('편집','서이현','연장근무', 60);
    insert into 상여금 (부서,이름,상여내역,상여금) values('편집','김선우','야간근무', 60);
    insert into 상여금 (부서,이름,상여내역,상여금) values('편집','황종근','야간근무', 50);
    insert into 상여금 (부서,이름,상여내역,상여금) values('편집','임주연','야간근무', 40);

    COMMIT;

    CREATE TABLE 여가활동(
        이름 VARCHAR(20),
        취미 VARCHAR(20),
        경력 INT,
        CONSTRAINT FK_NAME FOREIGN KEY(이름) REFERENCES 사원(이름)
    )
    -- ALTER TABLE 여가활동 RENAME COLUMN 이룸 TO 이름; 

    ALTER TABLE 여가활동 ADD CONSTRAINT PK_NAME PRIMARY KEY(이름); 
    -- 여가활동의 속성 '이름'은 기본키이면서, 사원 테이블의 이름을 참조하는 외래키이다.

    INSERT INTO 여가활동 (이름,취미,경력) VALUES('김현수','게임',10);
    INSERT INTO 여가활동 (이름,취미,경력) VALUES('장소정','당구',5);
    INSERT INTO 여가활동 (이름,취미,경력) VALUES('강국현','만화',15);
    INSERT INTO 여가활동 (이름,취미,경력) VALUES('홍길동','씨름',8);
    INSERT INTO 여가활동 (이름,취미,경력) VALUES('김땡땡','당구',10); -- 얘는 제약조건으로 추가 되지 않음

    COMMIT;

    <사원>
    이름       부서       생일         주소       기본급
    ---------- ---------- ------------ ---------- ------
    김현수     기획       04/05/61     관악구        120
    이현재     인터넷     11/09/69     중랑구         80
    최정상     편집       07/11/75     수성구        100
    장소정     편집       22/12/73     연희동         90
    홍길동     기획       01/09/69     강남구        110
    서지영     인터넷     13/03/77     구로구        100
    이대연     인터넷     25/06/70     관악구        110
    박소연     인터넷     14/12/72     수성구         90
    강국현     인터넷     05/09/73     관악구        100
    서이현     기획       17/05/65     노원구        110
    장선우     편집       16/05/71     관악구         90
    황종근     기획       10/03/67     도봉구        110
    임주연     편집       30/05/77     관악구         90

    <상여금>
    부서       이름       상여내역       상여금
    ---------- ---------- ---------- ----------
    기획       김현수     연장근무           50
    인터넷     이현재     연장근무           50
    편집       최정상     야간근무           60
    편집       장소정     특별근무           45
    기획       홍길동     특별근무           40
    인터넷     서지영     특별근무           50
    인터넷     이대연     연장근무           40
    인터넷     박소연     특별근무           40
    편집       강국현     특별근무           30
    편집       서이현     연장근무           60
    편집       김선우     야간근무           60
    편집       황종근     야간근무           50
    편집       임주연     야간근무           40

    <여가활동>
    이름       취미             경력
    ---------- ---------- ----------
    김현수     게임               10
    장소정     당구                5
    강국현     만화               15
    홍길동     씨름                8

    예제 1. 사원테이블의 모든 튜플을 검색하세요.
        
        -- 방법 1
        SELECT * 
        FROM 사원;

        -- 방법 2
        SELECT 사원.* 
        FROM 사원;

        -- 방법 3
        SELECT 이름,부서,생일,주소,기본급
        FROM 사원;

        -- 방법 4
        SELECT 사원.이름,사원.부서,사원.생일,사원.주소,사원.기본급
        FROM 사원;

    예제 2. 사원테이블에서 주소만 검색하되, 주소는 한번만 출력되게 하세요.

        -- 방법 1
        SELECT DISTINCT 주소 -- DISTINCT : 중복제거
        FROM 사원;

    예제 3. 사원 테이블에서 기본급에 특별수당 10을 더한 월급을 'xx부서의' 'xxx의' '월급 xxx'형태로 출력하세요.

        -- 방법 1
        SELECT 주소+'의', 이름+'의 월급', 기본급+10 AS 특별수당 -- 오라클의 경우 select concat(부서,'의'), from 사원;    
        FROM 사원;

    예제 4. 사원 테이블의 기획부의 모든 튜플을 검색하세요.

        -- 방법 1
        SELECT 부서
        FROM 사원
        WHERE 부서='기획'

    예제 5. 사원테이블의 기획부서에서 근무하면서 "관악구"에 사는 사람의 튜플을 검색하세요.

        -- 방법 1
        SELECT * 
        FROM 사원
        WHERE 부서='기획' AND 주소='관악구';

    예제 6. 사원테이블에서 부서가 기획이거나 인터넷인 튜플을 검색하세요.

        -- 방법 1
        SELECT * 
        FROM 사원
        WHERE 부서='기획' OR 부서='인터넷';

    예제 7. 사원테이블에서 성이 '김'인 사람의 튜플을 검색하세요.

        -- 방법 1
        SELECT * 
        FROM 사원
        WHERE 이름 LIKE "김%"; -- 오라클의 경우 SELECT * FROM 사원 WHERE 이름 LIKE '김%';

    예제 8. 사원 테이블에서 생일이 '01/01/69'에서 '12/31/73' 사이의 튜플을 검색하세요.

        -- 방법 1
        SELECT * FROM 사원 WHERE 생일 BETWEEN #01/01/69# AND #12/31/73#; 
            -- 오라클의 경우 : SELECT * FROM 사원 WHERE 생일 BETWEEN TO_DATE('01/01/69','DD/MM/YY') AND TO_DATE('31/12/73','DD/MM/YY');
        
    예제 9. 사원 테이블에서 주소가 NULL인 튜플을 검색하세요.

        -- 방법 1
        SELECT *
        FROM 사원
        WHERE 주소 IS NULL;

    예제 10. 사원 테이블에서 주소를 기준으로 오름차순, 같은 부서에 대해서는 이름을 기준으로 내림차순 정렬시켜 상위 10개의 튜플만 검색하세요.

        -- 방법 1
        SELECT TOP 10 *
        FROM 사원
        ORDER BY 부서 ASC, 이름 DESC;
            -- 오라클의 경우 SELECT * FROM 사원 WHERE ROWNUM<=10 ORDER BY 부서 ASC, 이름 DESC;

    예제 11. 취미가 게임인 사원의 이름과 주소를 검색하세요.
        
        -- 방법 1
        SELECT 이름,주소
        FROM 사원 -- 찾는 속성이 사원테이블에 있으므로, 취미활동은 검색하지 않는다.
        WHERE 이름 = ( -- 이름이 외래키로 지정된 여가활동 테이블 검색
            SELECT 이름
            FROM 여가활동
            WHERE 취미='게임'
        );

    예제 12. 취미활동을 안하는 사람을 검색하세요.

        -- 방법 1
        SELECT * 
        FROM 사원
        WHERE 이름 NOT IN ( -- 사원테이블의 이름이 여가활동에서 참조되고 있으므로 이름을 기준으로 검색
            SELECT 이름
            FROM 여가활동
        ); 

    예제 13. 강남구에 거주하는 사원보다 적은 기본급을 갖는 사람을 검색하세요.

        -- 방법 1
        SELECT * 
        FROM 사원
        WHERE 기본급 < ALL ( -- 자신의 테이블안에서 자신의 테이블 검색...ALL하면 튜플이 많을 경우 성능 하락이 심하다고 함.
            SELECT 기본급
            FROM 사원
            WHERE 주소='강남구'
        );

    예제 14. 경력 10년 이상인 사람의 이름,부서,취미,경력을 검색하세요.

        -- 방법 1
        SELECT 이름,부서,취미,경력
        FROM 사원,여가활동
        WHERE 여가활동.경력 >= 10 AND 사원.이름 = 여가활동.이름 
            -- 여가활동 경력 10년 이상인 사람을 고르되, 그렇게 해서 선별된 튜플의 이름값이 사원테이블의 이름값과 같아야한다. 

    예제 15. 사원테이블에서 기본급 90이상 100이하인 튜플의 수를 검색하세요 (IN 사용)

        -- 방법 1
        SELECT COUNT(기본급)
        FROM 사원
        WHERE 기본급 IN (90,110);

        -- 방법 2
        SELECT COUNT(기본급)
        FROM 사원
        WHERE 기본급 BETWEEN 90 AND 110;

        -- 방법 3
        SELECT COUNT(기본급)
        FROM 사원
        WHERE 기본급 >= 10 AND 기본급 <= 20;
        

    예제 16. 사원테이블에서 성이 '김'인 회원들을 기본급순으로 내림차순 정렬.

        -- 방법 1
        SELECT *
        FROM 사원
        WHERE 이름 LIKE '김%' 
        ORDER BY 기본급 DESC;

    예제 17. 사원테이블의 이름속성을 기준으로
    상여내역이 특별근무이고, 취미생활이 당구DLS 데이터의 이름,생일,주소,상여금,취미생활 검색하시오

        -- 방법 1
        SELECT 사원.이름,사원.생일,상여금.상여내역,주소,취미
        FROM 사원,상여금,여가활동
        WHERE 사원.이름 = 상여금.이름 
            AND 사원.이름 = 여가활동.이름 -- 사원.이름=여가활동.이름 값을 일치시키지 않으면 상여내역=특별근무인 이름 값에 취미=당구가 입력되어 나온다.
            AND 상여금.상여내역 = '특별근무'
            AND 여가활동.취미 = '당구'; 

    예제 18. 상여금테이블에서 상여금이 NULL값이 아닌 이름을 검색하세요.

        -- 방법 1
        SELECT 이름
        FROM 상여금
        WHERE 상여금 IS NOT NULL;

    예제 19. 상여금 테이블에서 상여내역별 상여금에 대한 일렬번호를 구하세요.

        -- 방법 1
        SELECT 상여내역,ROW_NUMBER() OVER(
            PARTITION BY 상여내역 ORDER BY 상여금 DESC
        ) AS 일련번호 -- ROW_NUMBER() 
        FROM 상여금;

        -- ROW_NUMBER() : 말 그대로 ROW의 수를 표기하는 속성. WINDOW 함수 중 하나이다. 
        -- PARTITION BY : WINDOW함수가 적용될 범위를 지시한다.
        -- WINDOW 함수에는 ROW_NUMBER(),RANK(),DENSE_RANK() 등이 있다. 

    예제 20. 상여금 테이블에서 상여내역별 상여금에 대한 순위를 검색하세요.
    (내림차순, 속성명은 상위금순위로 별칭)

        -- 방법 1
        SELECT 상여내역, 상여금, RANK() OVER( -- 순위에 대한 속성을 지정하기 위해 RANK() 이용
            PARTION BY 상여내역 ORDER BY 상여금 DESC ) AS 상여금순위,
        FROM 상여금

    예제 21. 상여금 테이블에서 부서별, 상여금 평균을 검색하세요.

        -- 방법 1
        SELECT 부서,AVG(상여금) AS 평균상여금
        FROM 상여금
        GROUP BY 부서;

        -- 결과
        부서       평균상여금
        ---------- ----------
        기획               45
        인터넷             45
        편집       49.2857143
    
    예제 22. 상여금 테이블에서 부서별 튜플의 수를 검색하세요.

        -- 방법 1
        SELECT 부서, COUNT(*) 부서당튜플수
        FROM 상여금
        GROUP BY 부서;

        -- 결과
        부서       부서당튜플수
        ---------- ------------
        기획                  2
        인터넷                4
        편집                  7


    예제 23. 상여금 테이블에서 상여금이 45이상인 사원이 2명 이상인 부서의 튜플의 수를 구하세요.

        -- 방법 1
        SELECT 부서, COUNT(*) AS 부원의수
        FROM 상여금
        WHERE 상여금 >= 45
        GROUP BY 부서
        HAVING COUNT(*) >= 2;

        /* 결과
            부서         부원의수
            ---------- ----------
            인터넷              2
            편집                5
        */
        /* 해석
            SELECT 부서
            FROM 상여금
            WHERE 상여금 >= 45;
            의 결과는 

            부서
            -------
            기획
            인터넷
            편집
            편집
            인터넷
            편집
            편집
            편집

            SELECT 부서, COUNT(*) AS 부원의수
            FROM 상여금
            WHERE 상여금 >= 45
            GROUP BY 부서;
            의 결과는 
            부서         부원의수
            ---------- ----------
            기획                1
            인터넷              2
            편집                5
            (... 이걸보니, GROUP BY절을 이용해 표준편차 조사를 할 수 있을거 같기도 하다...)
            GROUP BY는 '지정된 속성안의 값'들을 '각각 하나의 고유한 레코드 값'으로 묶는다.
            이것은 꼭 중복제거한 것과 그 모습이 비슷하다.
            그렇게 묶인 값에대해 검색을 수행하게 만들어준다.
            SELECT 부서, COUNT(*)를 작성하고, GROUP BY절을 작성하지 않으면 
            "단일 그룹의 그룹함수가 아니다"는 에러메세지가 출력된다.

            SELECT 부서, COUNT(*) AS 부원의수
            FROM 상여금
            WHERE 상여금 >= 45
            GROUP BY 부서
                HAVING COUNT(*) >= 2;
            의 결과는 
            부서         부원의수
            ---------- ----------
            인터넷              2
            편집                5
            
            HAVING절은 그룹으로 묶인 속성에 대한 값에 조건을 부여한다.
        */ 

    예제 24. 상여금 테이블의 부서,상여내역,부서별 상여내역 별 합계와 전체 합계를 검색하세요.
    (ROLLUP함수를 사용할 것)
        SOLVE.
        1. 속성은 부서,상여내역,상여금
            - SELECT 부서,상여내역,상여금
        2. 부서별 상여내역은 아래와 같은 데이터 형태를 원한다는 뜻
            부서    상여내역     
            ----    ---------
            부서1   상여내역1
            부서1   상여내역2
            부서2   상여내역1
        3. 상여금에 대해 부서별 상여내역 별 합계와 전체 합계는 아래와 같은 데이터 형태이다.
            부서    상여내역    상여금합계 
            ----    ---------   ---------
            부서1   상여내역1       100
            부서1   상여내역2       100
            부서1                   200
            부서2   상여내역1       50
            부서2   상여내역2       150
            부서2                   200
                                    400
        4. 상여금 합계는 부서, 상여내역 2개의 속성에의해 정해지는 합계이다.
        ROLLUP함수는 ROLLUP(속성1,속성2,...)의 형태로 속성의 개수가 1 ~ N+1레벨까지 데이터가 집계되고 그 형태는 아래와같다.
            부서    상여내역    상여금합계 
            ----    ---------   ---------
            부서1   상여내역1       100     --- 3레벨('각각의 부서, 각각의 상여내역'별 상여금의 합계)
            부서1   상여내역2       100     --- 3레벨('각각의 부서, 각각의 상여내역'별 상여금의 합계)
            부서1                   200     --- 2레벨(각각의 부서 상여금 합계) = 3레벨 상여금의 합계
            부서2   상여내역1       50
            부서2   상여내역2       150     ...
            부서2                   200   
                                    400     --- 1레벨(전체 상여금의 합계) = 2레벨 상여금의 합계
        
        5. 그럼이제 단계별 코드를 입력해보자
        SELECT 부서,상여내역,상여금
        FROM 상여금;
        결과는
        부서       상여내역       상여금
        ---------- ---------- ----------
        기획       연장근무           50
        인터넷     연장근무           50
        편집       야간근무           60
        편집       특별근무           45
        기획       특별근무           40
        인터넷     특별근무           50
        인터넷     연장근무           40
        인터넷     특별근무           40
        편집       특별근무           30
        편집       연장근무           60
        편집       야간근무           60
        편집       야간근무           50
        편집       야간근무           40

        6. 
        SELECT 부서,상여내역,SUM(상여금) AS 상여금합계
        FROM 상여금
        GROUP BY ROLLUP(부서,상여내역);
        결과는 
        부서       상여내역   상여금합계
        ---------- ---------- ----------
        기획       연장근무           50
        기획       특별근무           40
        기획                          90
        편집       야간근무          210
        편집       연장근무           60
        편집       특별근무           75
        편집                         345
        인터넷     연장근무           90
        인터넷     특별근무           90
        인터넷                       180
                                     615
        
    ;) ROLLUP은 .... select를 실행하면 속성의 값은 ↗ 방향으로 줄어든다. 
        속성1      속성2     속성3        집계값
        --------  --------   --------  ----------
        C1_1st     C2_1st     C3_1st      4 Level 
        C1_1st     C2_1st     C3_2nd      4 Level       
        C1_1st     C2_1st     C3_3rd      4 Level  
        C1_1st     C2_1st     C3_4th      4 Level                  
        C1_1st     C2_1st                 3 Level -- 3레벨은 해당 Row까지 집계된 4레벨의 합계이다.
        C1_1st     C2_2nd     C3_1st      4 Level                  
        C1_1st     C2_2nd     C3_2st      4 Level        
        C1_1st     C2_2nd                 3 Level 
        C1_1st     C2_3rd     C3_1st      4 Level                  
        C1_1st     C2_3rd     C3_2nd      4 Level
        C1_1st     C2_3rd     C3_3rd      4 Level        
        C1_1st     C2_3rd                 3 Level 
        C1_1st                            2 Level -- 2레벨은 해당 Row까지 집계된 3레벨의 합계이다.
                                          1 Level -- 전체 집계
        (속성1의 두번째 값이라 할 수 있는 C1_2nd는...그냥 너무 많아지므로 생략한다.)

    ;) CUBE는 반대로 결과가 ↙으로 늘어난다.
        -CUBE함수는 적용되는 속성이 N개면 집계되는 레벨의 수는 N^2이다.

    예제 25. 상여금 테이블에서 이름,부서,상여내역을 기준으로 상여금 합계와 전체합계를 검색하세요.
    (CUBE함수를 사용할 것)
        
        -- 방법 1
        SELECT 이름,부서,상여내역,SUM(상여금) AS 상여금합계
        FROM 상여금
        GROUP BY CUBE(부서,이름,상여내역);

        /* 
        Select 결과를 ... 요약하면
        이름       부서       상여내역   상여금합계
        ---------- ---------- ---------- -----------
                                                 615    --- 1레벨
                              야간근무           210    --- 2레벨
                              연장근무           200    --- 2레벨
                              특별근무           205    --- 2레벨
                        (생략)
        강국현                                   30     --- 3레벨
        강국현                특별근무           30     --- 4레벨
                        (생략)
                   기획                          90     --- 5레벨
                   기획       연장근무           50     --- 6레벨
                   기획       특별근무           40     --- 6레벨
                        (생략)
        김현수     기획                          50     --- 7레벨
        김현수     기획       연장근무           50     --- 8레벨

        ... 일반화하면
          속성1       속성2       속성3      집계값
        ---------- ----------  ---------- -----------
                                             1 Level
                                    O        2 Level

            O                                3 Level
            O                       O        4 Level

                        O                    5 Level
                        O           O        6 Level

            O                                7 Level                            
            O           O                    8 Level
                    
        1레벨 = 2레벨값들의 합
        3레벨 = 4레벨값들의 합
        5레벨 = 6레벨값들의 합 
        7레벨 = 8레벨값들의 합... 의 모습을 보여준다.
        
        1레벨,3레벨 등 홀수끼리/짝수끼리의 레벨은 서로 상관이 없는거 같다.
        */


    ;) 집합 연산자
    1. 합집합 UNION
    SELECT * 
    FROM 사원
    UNION -- 중복 허용은 UNION ALL
    SELECT * 
    FROM 직원;
    2. 교집합 INTERSECT
    SELECT * 
    FROM 사원
    INTERSECT -- 차집합은 EXCEPT
    SELECT * 
    FROM 직원;    